{% extends "base.html" %}
{% block title %}Problem Solving{% endblock %}
{% block content %}
<!-- Back Button - Top Left, Outside Box -->
<a href="/" class="inline-block mb-6 text-blue-600 hover:text-blue-800 font-bold text-lg">‚Üê Back to Home</a>

<div class="bg-white p-8 rounded shadow max-w-2xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold">üí° Problem Solving</h1>
            <p class="text-gray-600">Read the case study and provide your solution</p>
        </div>
        <div class="text-right">
            <p class="text-sm text-gray-600">Best Score</p>
            <p class="text-2xl font-bold text-blue-600">{{ best_score }}</p>
            {% if total_games > 0 %}
            <p class="text-xs text-gray-500">Problems solved: {{ total_games }}</p>
            {% endif %}
        </div>
    </div>

    <!-- Case Study -->
    <div class="bg-blue-50 p-6 rounded mb-6">
        <h2 class="text-xl font-bold mb-4">Case Study: Coffee Shop Inventory Problem</h2>
        <p class="text-gray-700 mb-4">
            Sarah runs a small coffee shop. Every morning she makes 50 cups of coffee, but:
        </p>
        <ul class="list-disc list-inside text-gray-700 mb-4">
            <li>By noon, she often runs out and disappointed customers leave</li>
            <li>At closing time, she throws away 10-15 unsold cups</li>
            <li>She wastes money on wasted coffee</li>
            <li>She loses customers who come back and find none available</li>
        </ul>
        <p class="font-bold text-gray-900">What would you suggest to solve this problem?</p>
    </div>

    <!-- Solution Input -->
    <div class="mb-6">
        <label class="block text-sm font-bold mb-2">Your Solution:</label>
        <textarea id="solution" rows="6" placeholder="Type your solution here..." 
                  class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
    </div>

    <!-- Buttons -->
    <div class="flex gap-4">
        <button onclick="submitSolution()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-bold">
            Submit Solution
        </button>
        <button onclick="document.getElementById('solution').value = ''" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-bold">
            Clear
        </button>
    </div>

    <!-- Feedback -->
    <div id="feedback" class="mt-6 p-4 rounded-lg hidden"></div>

    <!-- Score -->
    <div class="mt-8 text-center">
        <p class="text-2xl font-bold">Session Score: <span id="score">0</span></p>
    </div>
</div>

<script>
    function submitSolution() {
        const solution = document.getElementById('solution').value;
        
        if (!solution.trim()) {
            alert('Please write a solution');
            return;
        }

        let score = 0;
        score += Math.min(solution.length / 10, 100);
        
        const keywords = ['problem', 'solution', 'suggest', 'make', 'try', 'track', 'customer', 'waste'];
        const solutionLower = solution.toLowerCase();
        keywords.forEach(keyword => {
            if (solutionLower.includes(keyword)) {
                score += 10;
            }
        });
        
        score = Math.min(Math.round(score), 100);

        const feedback = document.getElementById('feedback');
        feedback.innerHTML = `<p class="font-bold text-green-700">‚úÖ Solution submitted!</p><p class="text-sm mt-2">Score: ${score}/100</p>`;
        feedback.className = 'mt-6 p-4 rounded-lg bg-green-100 text-green-900';
        
        document.getElementById('score').textContent = score;

        fetch('/api/save-score', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                game_type: 'problem_solving',
                score: score,
                difficulty: 'medium'
            })
        })
        .then(r => r.json())
        .then(data => {
            console.log('Score saved:', data);
            setTimeout(() => location.reload(), 2000);
        });
    }
</script>
{% endblock %}
