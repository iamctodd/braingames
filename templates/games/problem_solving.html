{% extends "base.html" %}
{% block title %}Problem Solving{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Back Button -->
    <a href="/" class="inline-block mb-6 text-primary hover:text-primary-light font-semibold transition-colors">‚Üê Back to Home</a>

    <!-- Game Container -->
    <div class="glass-card animate-in">
        <div class="flex justify-between items-start mb-8">
            <div>
                <h1 class="text-4xl font-bold mb-2">üí° Problem Solving</h1>
                <p class="text-text-secondary">Read and solve real-world case studies</p>
            </div>
            <div class="text-right">
                <p class="text-sm text-text-muted mb-1">Best Score</p>
                <p class="text-3xl font-bold text-success">{{ best_score }}</p>
                {% if total_games > 0 %}
                <p class="text-xs text-text-muted mt-1">Solved: {{ total_games }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Case Study -->
        <div class="bg-glass-bg border border-glass-border rounded-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4" id="caseTitle">Loading case study...</h2>
            <p class="text-text-secondary mb-4" id="caseDescription"></p>
            <ul class="list-disc list-inside text-text-secondary space-y-2 mb-4" id="casePoints"></ul>
            <p class="font-semibold text-text-primary">What would you suggest to solve this problem?</p>
        </div>

        <!-- Solution Input -->
        <div class="mb-6">
            <label class="block text-sm font-semibold mb-3">Your Solution</label>
            <textarea id="solution" rows="6" placeholder="Share your thoughts on how to solve this problem..." 
                      class="w-full px-4 py-3 bg-glass-bg border border-glass-border rounded-lg text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-primary transition-all resize-none"></textarea>
        </div>

        <!-- Controls -->
        <div class="flex gap-3 mb-8">
            <button onclick="submitSolution()" class="btn btn-primary flex-1">
                Submit Solution
            </button>
            <button onclick="nextProblem()" class="btn btn-secondary">
                Next Problem
            </button>
            <button onclick="document.getElementById('solution').value = ''" class="btn btn-secondary">
                Clear
            </button>
        </div>

        <!-- Feedback -->
        <div id="feedback" class="hidden"></div>

        <!-- Score -->
        <div class="text-center pt-6 border-t border-glass-border">
            <p class="text-sm text-text-muted mb-1">Session Score</p>
            <p class="text-3xl font-bold text-success" id="score">0</p>
        </div>
    </div>
</div>

<script>
    const casestudies = [
        {
            title: "Case Study 1: Coffee Shop Inventory Problem",
            description: "Sarah runs a small coffee shop. Every morning she makes 50 cups of coffee, but:",
            points: [
                "By noon, she often runs out and disappointed customers leave",
                "At closing time, she throws away 10-15 unsold cups",
                "She wastes money on wasted coffee",
                "She loses customers who come back and find none available"
            ]
        },
        {
            title: "Case Study 2: Team Communication Breakdown",
            description: "A software development team is struggling with project delays. The issues include:",
            points: [
                "Team members are not communicating progress effectively",
                "Tasks are duplicated because people don't know who's working on what",
                "Meetings are frequent but lack clear agendas",
                "Important decisions are being made without full team input"
            ]
        },
        {
            title: "Case Study 3: Customer Service Quality",
            description: "An online retailer is receiving poor customer satisfaction reviews. The problems are:",
            points: [
                "Response time to customer inquiries is slow (24-48 hours)",
                "Return process is complicated and frustrating",
                "No tracking information is provided during shipping",
                "Customer service representatives are not empowered to solve problems"
            ]
        },
        {
            title: "Case Study 4: Employee Turnover",
            description: "A tech startup is experiencing high employee turnover. Contributing factors include:",
            points: [
                "Lack of clear career growth paths for employees",
                "Compensation is below industry standards",
                "Work-life balance is poor with frequent overtime",
                "Company culture feels impersonal and not inclusive"
            ]
        },
        {
            title: "Case Study 5: Product Quality Issues",
            description: "A manufacturing company is facing increased defect rates. The situation is:",
            points: [
                "Quality control procedures have been rushed due to production deadlines",
                "Workers are not properly trained on new equipment",
                "There's no feedback loop to address emerging issues",
                "Management prioritizes speed over quality"
            ]
        }
    ];

    let currentCaseIndex = 0;
    let sessionScore = 0;

    function loadCaseStudy(index) {
        const caseStudy = casestudies[index % casestudies.length];
        document.getElementById('caseTitle').textContent = caseStudy.title;
        document.getElementById('caseDescription').textContent = caseStudy.description;
        
        const pointsList = document.getElementById('casePoints');
        pointsList.innerHTML = caseStudy.points.map(p => `<li>${p}</li>`).join('');
        
        document.getElementById('solution').value = '';
        document.getElementById('feedback').classList.add('hidden');
    }

    function nextProblem() {
        currentCaseIndex++;
        loadCaseStudy(currentCaseIndex);
    }

    function submitSolution() {
        const solution = document.getElementById('solution').value;
        
        if (!solution.trim()) {
            alert('Please write a solution');
            return;
        }

        let score = 0;
        score += Math.min(solution.length / 10, 100);
        
        const keywords = ['problem', 'solution', 'suggest', 'make', 'try', 'track', 'customer', 'waste', 'improve', 'process', 'team', 'communicate'];
        const solutionLower = solution.toLowerCase();
        keywords.forEach(keyword => {
            if (solutionLower.includes(keyword)) {
                score += 10;
            }
        });
        
        score = Math.min(Math.round(score), 100);
        sessionScore += score;

        const feedback = document.getElementById('feedback');
        feedback.innerHTML = `<div class="bg-glass-bg border border-success rounded-lg p-4"><p class="font-semibold text-success mb-2">‚úÖ Solution submitted!</p><p class="text-sm text-text-secondary">Score: ${score}/100</p></div>`;
        feedback.classList.remove('hidden');
        
        document.getElementById('score').textContent = sessionScore;

        fetch('/api/save-score', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                game_type: 'problem_solving',
                score: score,
                difficulty: 'medium'
            })
        })
        .then(r => r.json())
        .then(data => {
            console.log('Score saved:', data);
        });
    }

    loadCaseStudy(0);
</script>
{% endblock %}
